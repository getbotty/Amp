<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Jack Bauer</title>
  
  <!-- Generated by Bauer from /static/libs.json -->
  <link rel="stylesheet" href="/static/lib/styles.css" type="text/css" media="screen" charset="utf-8">
  <link rel="stylesheet" href="/static/styles.css" type="text/css" media="screen" charset="utf-8">
</head>
<body>
  <div id="container">
    <h1>Amp development area</h1>
    <h2>1. Core Module</h2>
    
    <div class="row">
      <label>Buttons</label>
      <button id="normal-button" type="button">Normal</button>
      <button id="checkbox-button" type="button">Checkbox</button>
      <button id="disabled-button" type="button">Disabled</button>
    </div>
    
    <div class="row">
      <label>Text Input</label>
      <input type="text" id="text-input" value="Hello">
    </div>
    
    <div class="row">
      <label>Number Input</label>
      <input type="text" id="number-input">
    </div>
    
    <div class="row">
      <label>Date Input</label>
      <input type="text" id="date-input">
    </div>

    <div class="row">
      <label>List</label>
      <div id="list" style="width: 200px; height: 100px">
    </div>
    
    <div class="row">
      <label>Combo</label>
      <input type="text" id="combo-input">
    </div>
    
    <div class="row">
      <label>Select</label>
      <button type="button" id="select-input" style="min-width:143px">&nbsp;</button>
    </div>
    
    <div class="row">
      <label>Tags</label>
      <div id="tags" style="width: 200px;">
    </div>
    
    <div class="row">
      <label>Modal</label>
      <button type="button" id="modal-button">Show Modal</button>
    </div>
    
    <h2>2. Grid</h2>
    
    <div class="row">
      <div id="grid"></div>
    </div>
    
  </div>
  
  <div id="modal">
    <div class="clearfix">
      <input id="modal-input" type="text" style="width: 200px;" placeholder="Example Input ...">
      <button id="modal-select" type="button" style="width: 210px;">Select Something</button>
      <br><br>
      <button type="button" id="modal-ok">Ok</button>
    </div>
  </div>
  
  <script src="/static/jquery.js"></script>
  <script src="/static/lib/scripts.js"></script><!-- Generated by Bauer from /static/libs.json -->
  <script>
    $(function(){
      
      var countries = [];
      
      $.ajax('/static/data/countries.json', {
        type: 'get',
        dataType: 'json',
        success: function(response){
          countries = response;
          
          $('#normal-button').amp('button', {  });
          $('#checkbox-button').amp('checkbox', {  });
          $('#disabled-button').amp('button', { disabled: true });
      
          $('#text-input').amp('text', {  });
          $('#number-input').amp('number', { value: 19, format: 2, min: 0.01, max: 9.99 });
          $('#date-input').amp('date', { changeYear: true, changeMonth: true, beforeShowDay: function(date){ return [date.getDay() % 6 !== 0, '']; } });
          $('#combo-input').amp('combo', { items: countries });
          $('#select-input').amp('select', { items: countries });
          $('#list').amp('list', { items: countries, multiple: true });
          $('#tags').amp('tags', { items: countries });
          
          $('#modal-button').amp('button', {}).on('click', function(){ $('#modal').amp().show(); });
          $('#modal').amp('modal', { });
          $('#modal-select').amp('select', { items: countries });
          $('#modal-input').amp('text', { });
          $('#modal-ok').amp('button', { });
          
          $('#date-input').amp().options.validator = [
            function(date){
              return date.getDay() % 6;
            },
            function(date){
              return date.getDate() !== 13;
            }
          ];

          $('#date-input, #text-input, #number-input, #combo-input, #select-input').amp().on('change', function(){
            console.log("Change " + this.element.attr('id'));
            this.disable()
          });
          
          
          var Item = Backbone.Model.extend({
            initialize: function(args){
              typeof args.date === 'string' && this.set('date', Date.parseDate('yy-mm-dd', args.date));
            }
          });
          
          var Items = Backbone.Collection.extend({
            model: Item,
            url: '/grid',

            // This is the grid definition
            grid: {
              pagination: {
                links:    9,
                pageSize: 3,
                dataSize: 60,
                pageAttr: 'p',
                sizeAttr: 's',
                method:   'changePage',
              },
              sorting: {
                initialCol: 'date',
                initialDir: 'asc',
                colAttr:    'sort',
                dirAttr:    'dir',
                method:     'changeSort'
              },
              columns: [
                { 
                  id:         "date",
                  type:       "date", 
                  name:       "Date",
                  format:     "yy-mm-dd", 
                  editable:   true, 
                  sortable:   true,
                  alsoChange: ["myDate"]
                },{
                  id:         "myDate",
                  type:       "text",
                  name:       "Date Text",
                  content:    function(item){
                    return Date.formatDate('mm/dd/yy', item.get('date'));
                  }
                },{
                  id:         "enum",
                  type:       "enum",
                  name:       "Enums",
                  items:      [{ value: "yes", label: "Indeed" }, { value: "no", label: "Not Quite So" }],
                  editable:   true,
                  falsy:      ""
                },{
                  id:         "combo",
                  type:       "combo",
                  name:       "Combo",
                  items:      countries,
                  editable:   true,
                  content:    function(item){
                    return "<span style='color:red'>" + item.get("combo") + "</span>";},
                  falsy:      ""
                },{ 
                  id: "disbursement", 
                  type: 'number', 
                  name: "Disbursement", 
                  format: 2,
                  action: function(item) {
                    return {
                      icon: 'icon-recycle',
                      handler: function(){
                        alert(item.cid)
                      }
                    }
                  }
                },
                { id: "interestRate", type: 'number', name: "Rate in %",    format: 5, editable: true, sortable: true },
                { id: "repayment",    type: 'number', name: "Repayment",    format: 2, fallback: 0, editable: true },
                { id: "accrued",      type: 'number', name: "Accrued",      format: 2 },
                { id: "comment",      type: 'text', name: "Comments",     format: null, editable: true, sortable: true  }
              ]
            },
    
            changeSort: function(prop, direction, query){
              this.trigger('reset');
            },
    
            changePage: function(page, query){
              this.url = '/grid?' + query;
              this.fetch();
            }
          });
          
          var data = new Items();
          var grid = $('#grid').amp('grid', {
            datasource: data,
          });
  
          data.on('reset', function(){ grid.render(); }).fetch();
        }
      });
            
    });
  </script>
</body>
</html>